<!-- Remove portal -->
<properties
   pageTitle="什么是 Azure SQL 数据仓库 | Azure"
   description="企业级分布式数据库，可处理 PB 量级的关系数据和非关系数据。它是行业首个云数据仓库，可以在数秒内增长、收缩和暂停。"
   services="sql-data-warehouse"
   documentationCenter="NA"
   authors="lodipalm"
   manager="barbkess"
   editor=""/>

<tags
   ms.service="sql-data-warehouse"
   ms.date="07/16/2016"
   wacn.date="08/22/2016"/>



# 什么是 Azure SQL 数据仓库？

Azure SQL 数据仓库是基于云的一种可扩展的数据库，用于处理大量数据（关系数据和非关系数据）。它在大规模并行处理 (MPP) 体系结构的基础上构建，可处理企业工作负荷。

SQL 数据仓库：

- 将验证过的 SQL Server 关系数据库与 Azure 云可扩展功能相结合，可在数秒内进行增加、减少、暂停或恢复计算。用户可在需要时扩展 CPU，并在非高峰时段削减使用量，节省成本。
- 利用 Azure 平台。它易于部署、无缝维护且完全容错（源自其自动备份功能）。
- SQL Server 生态系统的补充。可使用熟悉的 SQL Server T-SQL 和工具进行开发。

以下讲述SQL 数据仓库的主要功能。

## 大规模并行处理体系结构

SQL 数据仓库使用微软公司的大规模并行处理 (MPP) 体系结构，其设计目的是运行世界上最大的本地数据仓库。

目前， MPP 体系结构将用户数据分布在 60 个无共享的存储和处理单元上，这些数据存储于高级本地冗余存储中，并链接到计算节点，用于执行查询。使用此体系结构，SQL 数据仓库采用分而治之的方法运行复杂的 T-SQL 查询。控制节点进行处理时，会优化每个查询，继而将工作转交给计算节点，每个计算节点并行“攻克”其对应的数据。

将 MPP 体系结构与 Azure 存储功能相结合，SQL 数据仓库可以：

- 独立计算，自由缩放存储空间。
- 无需移动数据，自由增减计算。
- 随时暂停计算，同时保持数据不变。
- 随时恢复计算。

下面详细介绍该体系结构。

![SQL 数据仓库体系结构][1]  



**控制节点：** 管理和优化查询。作为前端与所有应用程序和连接进行交互。在 SQL 数据仓库中，控制节点由 SQL 数据库提供支持，两者连接时外观非常相似。表面下，控制节点协调所有数据的移动和计算，这些移动和计算必须与分布式数据并行查询。将 TSQL 查询提交到 SQL 数据仓库时，控制节点会将其转换为单独查询，并在每个计算节点上并行运行。

**计算节点：** 计算节点是 SQL 数据仓库的“供电器”。它们是用于存储数据、处理查询的 SQL 数据库。需要添加数据时，SQL 数据仓库将行分配给计算节点。计算节点在数据上运行并行查询，处理完成后，结果传回控制节点。若要完成查询，控制节点需整合并返回最终结果。

**存储：** 数据存储在 Azure 存储 Blob 中。计算节点与数据交互时，数据直接写入 blob 存储中并直接从 blob 读取。 Azure 存储空间可透明、无限地扩展，因 SQL 数据仓库同样可以。由于计算与存储是独立的，SQL 数据仓库可自动将缩放存储与缩放计算分开进行，反之亦然。Azure 存储空间还可以完全容错，简化备份和还原过程。

**数据移动服务：** 数据移动服务 (DMS) 是在节点之间移动数据的技术。计算节点需联接或聚合数据时，DMS 给予其数据访问权限。DMS 不是 Azure 服务。它是在所有节点上与 SQL 数据库一起运行的 Windows 服务。由于 DMS 在后台运行，因此用户不会直接与它交互。但是查询计划中包括某些 DMS 操作，因为并行运行每个查询时，数据必须以某种形式进行移动。


## 优化查询性能

数据仓库许多特定性能的优化对 MPP 方法大有帮助，这些优化包括：

- 针对所有数据的分布式查询优化器和复杂的统计。服务可使用有关数据大小和分布的信息，通过评估特定分布式查询操作的成本来优化查询。

- 集成到数据移动进程中的高级算法和技术，可以根据需要有效地在计算资源之间移动数据，执行查询。这些数据移动操作是内置的，数据移动服务的所有优化自动进行。

- 默认为聚集列存储索引。与传统的行存储相比，SQL 数据仓库的列存储最大可将压缩率提高 5 倍，将查询性能提高 10 倍。尽管分析查询需浏览大量行，但它使用列存储索引也很好的工作。


## 可缩放

SQL 数据仓库的体系结构引入了独立的存储和计算功能，他们可单独进行缩放。SQL 数据库快速、简单的部署结构可以实现即时附加计算，可借助 Azure 存储 Blob 来实现。 Blob 不仅提供稳定的复制存储，而且还提供低成本的轻松扩展基础结构。云规模存储和 Azure 计算结合时，SQL 数据仓库可利用他们允许用户支付查询性能存储的费用（即需即付）。更改计算量操作非常简单，还可使用 T-SQL 和 PowerShell 进行计划。

SQL 数据仓库不仅可以独立于存储完全控制计算量，还允许用户完全暂停数据仓库。在保留存储位置的同时，所有计算资源将释放到 Azure 的主池，立即为用户节省费用。必要时，用户只需简单恢复计算，让工作负荷使用数据和计算资源即可。

## 数据仓库单位

SQL 数据仓库的计算用量由 SQL 数据仓库单位 (DWU) 计量。DWU 用以衡量数据仓库的基本能力，确保用户在指定时间拥有与仓库相关的标准性能。具体而言，使用 DWU 来确保：

- 不必考虑基础硬件或软件，轻松缩放数据仓库

- 更改数据仓库的大小之前，可预测 DWU 级别的性能改进

- 可更改或移动实例的基础硬件与软件，不影响工作负荷性能

- 可调整服务的基础体系结构，不影响工作负荷的性能

- 快速提升 SQL 数据仓库性能时，确保以可缩放、平稳的方式实现。

由于数据仓库负荷性能与三大精确度量紧密相关，因此指定数据仓库单元专门测量这三大度量。如果这些关键工作负荷度量值 可与用户为其数据仓库选择的 DWU 呈线性缩放，则达到预期目的。

**扫描/聚合：** 此工作负荷度量值采用标准数据仓库查询，扫描大量的行，然后执行复杂聚合。这是 IO 和 CPU 的一种密集型操作。

**负载：** 此度量值度量将数据引入服务的能力。PolyBase 从 Azure 存储 Blob 中加载具代表性的数据集，完成负载。此度量值用于增加网络和 CPU 方面的压力。

**Create Table As Select (CTAS)：** CTAS 度量创建表副本的能力。这涉及到从存储读取数据、跨设备的节点分发以及重新写入存储。这是 CPU 和网络的一种密集型操作。

## 按需暂停和缩放

如果需要结果更快速，可以增加 DWU， 购买更好的性能。如果需要较小的计算能力，可以减少 DWU ，仅购买需要的性能。以下为可以考虑更改 DWU 的情形：

- 如果无需运行查询（晚上或周末），则停止查询，暂停计算资源，避免不需要 DWU 时仍为之付费。

- 如果系统的资源需求较低，考虑将 DWU 减少到允许用户访问数据即可，可大量节约成本。

- 如果执行繁重的数据加载或转换操作，增加 DWU ，可以更快获取数据。

- 如果要了解理想的 DWU 值，请在加载数据后尝试增加或减少 DWU 、并运行几个查询。由于缩放很快就能完成，可以尝试不同级别的性能（不用超过一小时即可得知）。

> [AZURE.NOTE] 请注意，由于 SQL 数据仓库的体系结构，在数据量不多的情况下，可能看不到预期的性能。建议从大于或等于 1 TB 的数据卷开始，可获得性能优势的真实指示。

## 在 SQL Server 的基础上构建

SQL 数据仓库基于 SQL Server 已验证的关系数据库引擎，包含用户希望企业数据仓库拥有的许多功能。如果用户熟悉 Transact-SQL，使用 SQL 数据仓库时可以轻松运用这些知识。无论高级用户还是新手，都可以从本文档中的示例开始着手。总体上，用户可以考虑我们构建 SQL 数据仓库的语言元素的方式，如下所示：

- SQL 数据仓库使用 SQL Server 的 Transact-SQL (TSQL) 语法，支持广泛的传统 SQL 构造，例如存储过程、用户定义函式、表分区、索引和排序规则等。

- SQL 数据仓库还包含最新的 SQL Server 功能，包括群集列存储索引、PolyBase 集成和数据审核（随附威胁评估）等。

- SQL 数据仓库仍处于开发阶段，某些 TSQL 语言元素对于数据仓库工作负荷不太常见，或者对于SQL Server过于新颖，因此这些元素目前可能无法使用。请参阅[迁移文档][]，获取与此问题相关的详细信息。

借助 SQL Server、SQL 数据仓库、SQL 数据库和分析平台系统之间的 Transact-SQL 与功能共通性，能够开发符合数据需求的解决方案。你可以根据性能、安全和缩放要求，决定存储数据的位置，然后根据需要在不同系统之间传输数据。

## 数据保护

SQL 数据仓库将 Azure 高级版中的所有数据存储在本地冗余存储中。将在本地数据中心内维护数据的多个同步副本，确保在发生局部故障时能够保证提供透明的数据保护。此外，SQL 数据仓库会使用 Azure 存储空间快照，定期自动备份活动（未暂停）数据库。若要详细了解备份和还原的工作原理，请参阅[备份和还原概述][]。

## 与 Microsoft 工具相集成

除了采用 SQL Server 的 TSQL 外围应用，SQL 数据仓库还集成了 SQL Server 用户可能熟悉的许多工具。具体而言，我们着重于SQL 数据仓库的几个类别的集成工具，包括：

**传统的 SQL Server 工具：** SQL 数据仓库与 SQL Server Analysis Services、Integration Services 和 Reporting Services 完全集成。

**基于云的工具：** SQL 数据仓库可与 Azure 中的多个新工具一起使用，并与 Azure 的数据工厂、流分析、机器学习和 Power BI 紧密集成。有关集成的 Azure 工具列表，请参阅[集成工具概述][]。

**第三方工具：** 大量的第三方工具提供商确认能够与 SQL 数据仓库集成。有关合作伙伴的完整列表，请参阅 [SQL 数据仓库解决方案合作伙伴][]。

## 混合方案

配合 PolyBase 使用 SQL 数据仓库，用户即可在其生态系统之间移动数据（前所未有），用非关系与本地数据源设置高级混合方案。

Polybase 易于使用，用户通过使用熟悉的 T-SQL命令，可从不同源使用数据。Polybase 使得用户可以像查询普通表一样查询 Azure Blob 存储中的非关系数据。使用 Polybase 可以查询非关系数据，或者将非关系数据导入 SQL 数据仓库。

- PolyBase 使用外部表访问非关系数据。表定义存储在 SQL 数据仓库中，可以通过 SQL 和用于访问普通关系数据的工具进行访问。

- Polybase 并不知晓其集成状态。它将相同的特性和功能提供给其支持的所有源。Polybase 可读取各种格式的数据，包括分隔文件或 ORC 文件。

PolyBase 可以访问同时用作 HD Insight 群集存储的 Blob 存储，用户可以使用关系型和非关系型工具优先访问相同数据。

## 后续步骤

对 SQL 数据仓库有了初步的认识后，请继续了解 [数据仓库工作负荷]、[如何预配] SQL 数据仓库，以及[如何加载示例数据]。或者，查看一下以下一些其他 SQL 数据仓库资源。

- [CAT 团队博客]
- [MSDN 论坛]


<!--Image references-->
[1]: ./media/sql-data-warehouse-overview-what-is/dwarchitecture.png

<!--Article references-->
[如何加载示例数据]: /documentation/articles/sql-data-warehouse-load-sample-databases/
[如何预配]: /documentation/articles/sql-data-warehouse-get-started-provision-powershell/
[迁移文档]: /documentation/articles/sql-data-warehouse-overview-migrate/
[集成工具概述]: /documentation/articles/sql-data-warehouse-overview-integrate/
[备份和还原概述]: /documentation/articles/sql-data-warehouse-restore-database-overview/

<!--MSDN references-->

<!--Other Web references-->

[CAT 团队博客]: https://blogs.msdn.microsoft.com/sqlcat/tag/sql-dw/
[MSDN 论坛]: https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureSQLDataWarehouse

<!---HONumber=Mooncake_0815_2016-->